<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js Scene</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block; /* Prevent canvas from displaying inline */
        }
    </style>
    <!-- Include Three.js and other necessary libraries -->
    <script src="../ThreeJS-Code/GLTFmodel/js/three.min.js"></script>
    <script src="../ThreeJS-Code/GLTFmodel/js/orbitcontrols.js"></script>
    <script src="../ThreeJS-Code/GLTFmodel/js/GLTFLoader.js"></script>
</head>
<body>
    <canvas id="gl-canvas"></canvas>
    <script>
        window.onload = function init() {
            const canvas = document.getElementById("gl-canvas");
            const renderer = new THREE.WebGLRenderer({ canvas });
            renderer.setSize(window.innerWidth, window.innerHeight); // Use the full window size
            renderer.outputEncoding = THREE.sRGBEncoding;

            // Scene and Camera setup
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x404040);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 150, 400); // 카메라 위치 조정

            // Controls for the camera
            const controls = new THREE.OrbitControls(camera, renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 5);
            scene.add(ambientLight);

            const light = new THREE.PointLight(0xc4c4c4, 1);
            light.position.set(0, 300, 500); // 조명 위치 조정
            scene.add(light);

            // Texture Loader
            const loader = new THREE.TextureLoader();
            const baseColor = loader.load("../textures/Snow_004_COLOR.jpg");
            const normalMap = loader.load("../textures/Snow_004_NORM.jpg");
            const roughnessMap = loader.load("../textures/Snow_004_ROUGH.jpg");
            const heightMap = loader.load("../textures/Snow_004_DISP.png");
            const ambientOcclusionMap = loader.load("../textures/Snow_004_OCC.jpg");

            // Create a sphere with textures
            const sphere = createSphere(100, 64);
            scene.add(sphere); // Add sphere to scene

            function createSphere(radius, segments) {
                return new THREE.Mesh(
                    new THREE.SphereGeometry(radius, segments, segments),
                    new THREE.MeshStandardMaterial({
                        map: baseColor,
                        normalMap: normalMap,
                        roughnessMap: roughnessMap,
                        displacementMap: heightMap,
                        aoMap: ambientOcclusionMap,
                        roughness: 3.0,
                        metalness: 0.0,
                        displacementScale: 0.03,
                    })
                );
            }

            // GLTFLoader for loading 3D model
            const gltfLoader = new THREE.GLTFLoader();
            let mixer;

            gltfLoader.load('../toon_cat_free/scene.gltf', function (gltf) {
                const model = gltf.scene;
                model.scale.set(0.1, 0.1, 0.1); // Adjust the size of the cat model (if needed)

                // Position the cat on the surface of the sphere
                const sphereRadius = 100; // Radius of the sphere
                model.position.set(0, sphereRadius, 0); // Adjust the height based on the sphere radius

                scene.add(model);

                if (gltf.animations && gltf.animations.length > 0) {
                    mixer = new THREE.AnimationMixer(model);
                    gltf.animations.forEach((clip) => {
                        mixer.clipAction(clip).play();
                    });
                }
            }, undefined, function (error) {
                console.error('An error occurred while loading the model:', error);
            });

            // Rendering and animation loop
            function animate() {
                requestAnimationFrame(animate);

                // Update animations if mixer exists
                if (mixer) mixer.update(0.01);

                controls.update();
                renderer.render(scene, camera);
            }

            animate(); // Start the animation loop
        }
    </script>
</body>
</html>
